spryk: wrapper
description: "Adds a Registry code for Apps. It builds connect and disconnect logic."
priority: 1
mode: both
level: 2

arguments:
    organization:
        inherit: true
        default: Spryker

    module:
        inherit: true

excludedSpryks:
    - AddZedPresentationTwig
    - AddZedNavigationNode

preSpryks:
    - AddModule

postSpryks:
    - AddZedBusinessModelMethod:
          arguments:
              className:
                  value: Registry
              subDirectory:
                  value: Registry
              modelMethod:
                  value: connect
              input:
                  value: "\\Generated\\Shared\\Transfer\\{{ module }}Transfer ${{ module | lcfirst }}Transfer"
              output:
                  value: "\\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer"
              body:
                  value: "${{ module | lcfirst }}ResponseTransfer = new \\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer();\n\n        return ${{ module | lcfirst }}ResponseTransfer;"

    - AddZedBusinessModelMethod:
          arguments:
              className:
                  value: Registry
              subDirectory:
                  value: Registry
              modelMethod:
                  value: disconnect
              input:
                  value: "\\Generated\\Shared\\Transfer\\{{ module }}Transfer ${{ module | lcfirst }}Transfer"
              output:
                  value: "\\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer"
              body:
                  value: "${{ module | lcfirst }}ResponseTransfer = new \\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer();\n\n        return ${{ module | lcfirst }}ResponseTransfer;"

    - AddZedCommunicationControllerAction:
          excludedSpryks:
              - AddZedPresentationTwig
              - AddZedNavigationNode
          arguments:
              input:
                  value: "\\Symfony\\Component\\HttpFoundation\\Request $request"
              output:
                  value: "\\Symfony\\Component\\HttpFoundation\\JsonResponse"
              controller:
                  value: RegistryController
              controllerMethod:
                  value: connectAction
              body:
                  value:
                    - "${{ module | lcfirst }}ResponseTransfer = new {{ module }}ResponseTransfer();"
                    - "${{ module | lcfirst }}ResponseTransfer = $this->getFactory()"
                    - "    ->createRequestValidator()"
                    - "    ->validateRequest($request, ${{ module | lcfirst }}ResponseTransfer);"
                    - ""
                    - "$responseBuilder = $this->getFactory()->createResponseBuilder();"
                    - ""
                    - "if (!${{ module | lcfirst }}ResponseTransfer->getIsSuccessful()) {"
                    - "    return $this->jsonResponse($responseBuilder->createResponse(${{ module | lcfirst }}ResponseTransfer), Response::HTTP_BAD_REQUEST);"
                    - "};"
                    - ""
                    - "${{ module | lcfirst }}Transfer = $this->getFactory()->createRequestToTransferMapper()->mapRequestToTransfer($request);"
                    - ""
                    - "${{ module | lcfirst }}ResponseTransfer = $this->getFacade()->connect(${{ module | lcfirst }}Transfer, ${{ module | lcfirst }}ResponseTransfer);"
                    - ""
                    - "if (!${{ module | lcfirst }}ResponseTransfer->getIsSuccessful()) {"
                    - "    return $this->jsonResponse($responseBuilder->createResponse(${{ module | lcfirst }}ResponseTransfer), /* What to put here? */);"
                    - "};"
                    - ""
                    - "return $this->jsonResponse($responseBuilder->createResponse(${{ module | lcfirst }}ResponseTransfer));"

    - AddZedCommunicationControllerAction:
          excludedSpryks:
              - AddZedPresentationTwig
              - AddZedNavigationNode
          arguments:
              input:
                  value: "\\Symfony\\Component\\HttpFoundation\\Request $request"
              output:
                  value: "\\Symfony\\Component\\HttpFoundation\\JsonResponse"
              controller:
                  value: RegistryController
              controllerMethod:
                  value: disconnectAction
              body:
                  value:
                      - "${{ module | lcfirst }}Transfer = new {{ module }}Transfer();"
                      - "${{ module | lcfirst }}ResponseTransfer = $this->getFacade()->connect(${{ module | lcfirst }}Transfer);"

    - AddZedBusinessFacadeMethod:
        arguments:
            facadeMethod:
                value: connect
            input:
                value: "\\Generated\\Shared\\Transfer\\{{ module }}Transfer ${{ module | lcfirst }}Transfer"
            output:
                value: "\\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer"
            body:
                value: "return $this->getFactory()->createRegistry()->connect(${{ module | lcfirst }}Transfer);"

    - AddZedBusinessFacadeMethod:
        arguments:
            facadeMethod:
                value: disconnect
            input:
                value: "\\Generated\\Shared\\Transfer\\{{ module }}Transfer ${{ module | lcfirst }}Transfer"
            output:
                value: "\\Generated\\Shared\\Transfer\\{{ module }}ResponseTransfer"
            body:
                value: "return $this->getFactory()->createRegistry()->disconnect(${{ module | lcfirst }}Transfer);"

    - AddSharedTransferDefinition:
        arguments:
            name:
                value: "{{ module }}Transfer"

    - AddSharedTransferDefinition:
        arguments:
            name:
                value: "{{ module }}Transfer"


